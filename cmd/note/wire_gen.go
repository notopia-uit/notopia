// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/goforj/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package main

import (
	"context"
	http2 "github.com/notopia-uit/notopia/pkg/common/controller/http"
	"github.com/notopia-uit/notopia/pkg/common/otlp"
	"github.com/notopia-uit/notopia/pkg/note/app"
	"github.com/notopia-uit/notopia/pkg/note/component"
	"github.com/notopia-uit/notopia/pkg/note/config"
	"github.com/notopia-uit/notopia/pkg/note/controller/http"
	"github.com/spf13/viper"
)

// Injectors from wire.go:

func InitializeServer(ctx context.Context) (*http.Server, func(), error) {
	serviceName := _wireServiceNameValue
	validate := components.ProvideValidate()
	viperViper := viper.New()
	configConfig, err := config.NewConfig(validate, viperViper)
	if err != nil {
		return nil, nil, err
	}
	configOTLP := configConfig.OTLP
	serviceVersion := _wireServiceVersionValue
	resource, err := otlp.NewResource(serviceName, serviceVersion)
	if err != nil {
		return nil, nil, err
	}
	meterProvider, cleanup, err := otlp.NewMeterProvider(ctx, configOTLP, resource)
	if err != nil {
		return nil, nil, err
	}
	tracerProvider, cleanup2, err := otlp.NewTracerProvider(ctx, configOTLP, resource)
	if err != nil {
		cleanup()
		return nil, nil, err
	}
	loggerProvider, cleanup3, err := otlp.NewLoggerProvider(ctx, configOTLP, resource)
	if err != nil {
		cleanup2()
		cleanup()
		return nil, nil, err
	}
	logger := otlp.NewSlog(serviceName, configOTLP, loggerProvider)
	ginSlogHandlerFunc := http2.NewGinSlogHandler(logger)
	otelGinHandlerFunc := http2.NewOtelGinHandler(serviceName, meterProvider, tracerProvider)
	engine := http2.NewGin(serviceName, meterProvider, tracerProvider, ginSlogHandlerFunc, otelGinHandlerFunc)
	appApp := app.NewApp()
	strictHTTPHandler := http.NewStrictHTTPHandler(appApp)
	serverInterface := http.NewHTTPHandler(strictHTTPHandler)
	rpcHandler := http.NewRPCHandler(appApp)
	rpchttpHandlerRegister, err := http.NewRPCHTTPHandlerRegister(rpcHandler, tracerProvider, meterProvider)
	if err != nil {
		cleanup3()
		cleanup2()
		cleanup()
		return nil, nil, err
	}
	server := http.NewServer(engine, serverInterface, rpchttpHandlerRegister, logger, configConfig)
	return server, func() {
		cleanup3()
		cleanup2()
		cleanup()
	}, nil
}

var (
	_wireServiceNameValue    = components.ServiceName
	_wireServiceVersionValue = components.ServiceVersion
)
