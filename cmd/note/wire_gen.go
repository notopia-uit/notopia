// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/goforj/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package main

import (
	"context"
	"github.com/notopia-uit/notopia/pkg/common/otlp"
	"github.com/notopia-uit/notopia/pkg/note/app"
	"github.com/notopia-uit/notopia/pkg/note/components"
	"github.com/notopia-uit/notopia/pkg/note/config"
	"github.com/notopia-uit/notopia/pkg/note/ports"
	"github.com/notopia-uit/notopia/pkg/note/ports/http"
	"github.com/notopia-uit/notopia/pkg/note/ports/rpc"
	"github.com/spf13/viper"
)

// Injectors from wire.go:

func InitializeServer(ctx context.Context) (*ports.Server, func(), error) {
	serviceName := _wireServiceNameValue
	validate := components.ProvideValidate()
	viperViper := viper.New()
	configConfig, err := config.NewConfig(validate, viperViper)
	if err != nil {
		return nil, nil, err
	}
	configOTLP := configConfig.OTLP
	serviceVersion := _wireServiceVersionValue
	resource, err := otlp.NewResource(serviceName, serviceVersion)
	if err != nil {
		return nil, nil, err
	}
	loggerProvider, cleanup, err := otlp.NewLoggerProvider(ctx, configOTLP, resource)
	if err != nil {
		return nil, nil, err
	}
	logger := otlp.NewSlog(serviceName, configOTLP, loggerProvider)
	handlerFunc := http.NewSlogHandler(logger)
	engine := http.NewGin(handlerFunc)
	appApp := app.NewApp()
	strictServer := http.NewStrictServer(appApp)
	serverInterface := http.NewServer(strictServer)
	rpcHandler := rpc.NewRPCHandler(appApp)
	tracerProvider, cleanup2, err := otlp.NewTracerProvider(ctx, configOTLP, resource)
	if err != nil {
		cleanup()
		return nil, nil, err
	}
	meterProvider, cleanup3, err := otlp.NewMeterProvider(ctx, configOTLP, resource)
	if err != nil {
		cleanup2()
		cleanup()
		return nil, nil, err
	}
	httpServiceHandler, err := rpc.NewHTTPServiceHandler(rpcHandler, tracerProvider, meterProvider)
	if err != nil {
		cleanup3()
		cleanup2()
		cleanup()
		return nil, nil, err
	}
	server := ports.NewServer(engine, serverInterface, httpServiceHandler, logger, configConfig)
	return server, func() {
		cleanup3()
		cleanup2()
		cleanup()
	}, nil
}

var (
	_wireServiceNameValue    = components.ServiceName
	_wireServiceVersionValue = components.ServiceVersion
)
